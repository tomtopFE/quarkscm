//=========================公共方法===============================
var TT_NS=function(g,a){function h(){this.uploadForm=a("#photo-form");this.saveBtn=a("#head_image_save");this.previewEle=a("#preview");this.inputFile=this.uploadForm.find(":file");this.erroMsg=a(".erro_msg");this.loading=a(".upload_loding");this.saveBtn.attr("disabled","disabled");this.acceptSize=120;this.loading=a(".upload_loding").hide();this.listener()}function k(){a(".copy").zclip({path:TT_CONFIG.staticUrl+"/js/ZeroClipboard.swf",copy:function(){return a(this).prev(".copyTxt").text()},afterCopy:function(){a(this).next(".sucTips").show();var b=a(this).parents(".m_zclip_copy").siblings(".share_pic"),c=b.attr("data-sku"),d=b.attr("data-listingid"),e=b.attr("data-storageid"),f=b.attr("data-actcode"),b=b.data("url");a.ajax({type:"POST",url:"/get-it-free/count",data:{sku:c,listingId:d,storageId:e,actCode:f,sharePlatform:"copy",shareUrl:b},dataType:"json",success:function(a){}})}})}a(document).on("click",".m_pullDown_country .result,.m_pullDown_country .arrow",function(b){a(this).closest(".left").removeClass("error");a(this).siblings(".m_more_country").slideToggle();a(this).parents(".m_pullDown_country").find(".arrow").toggleClass("down");b.stopPropagation()});a(document).on("click",".m_pullDown_country .m_more_country li",function(){var b=a(this).html(),c=a(this).parents(".m_pullDown_country").find(".result"),d=a(this).attr("class");c.removeClass().addClass("result "+d);c.html(" ");c.html(b);b=a(this).attr("countryid");a(this).parent().parent().find(".country_id").val(b);a(this).parents(".m_more_country").slideUp();a(this).parents(".m_pullDown_country").find(".arrow").removeClass("down")});a(document).on("mouseleave",".m_pullDown_country",function(b){a(".m_more_country").slideUp();a(".m_pullDown_country").find(".arrow").removeClass("down")});a(document).on("click",".m_pullDown_country .m_more_country",function(a){a.stopPropagation()});a(document).on("keyup",".m_pullDown_country .m_more_country input",function(){var b=a(this).val().toLowerCase();a(this).parents(".m_more_country").find("li").each(function(){-1!=a(this).find("em").text().toLowerCase().search(b)?a(this).show():a(this).hide()})});a("#editAccount .profile_edit").click(function(){a("#editAccount li").removeClass("error");a("#editAccount").find(".proText").each(function(){""==a(this).val()&&(a(this).siblings("em").show().text(TT_NS.lang.getLangForKey("account.cantLeaveEmpty")),a(this).closest("li").addClass("error"))});a("input[name\x3d'gender']:checked").val()||(a("input[name\x3d'gender']").siblings("em").show().text(TT_NS.lang.getLangForKey("account.cantLeaveEmpty")),a("input[name\x3d'gender']").closest("li").addClass("error"));var b=!0,c=a(".bm_birthday").find(".hobby_birthday");c.each(function(){""==a(this).val()&&(b=!1)});b?(c.closest("li").find(".birth_error").hide(),c.closest("li").removeClass("error")):(c.closest("li").find(".birth_error").show().text(TT_NS.lang.getLangForKey("account.cantLeaveEmpty")),c.closest("li").addClass("error"));if(0==a("#editAccount").find(".error").length)c=a("#editAccount").serializeArray(),a.ajax({type:"POST",url:"/profile/editprofile",data:c,dataType:"json",success:function(b){if(1==b.ret)window.location.reload();else{var c=a("#editAccount input[name\x3d'account']");c.closest("li").addClass("error");c.siblings().text(b.msg)}}});else return!1});a("#editAccount .proText").blur(function(){""==a(this).val()&&(a(this).siblings("em").text(TT_NS.lang.getLangForKey("account.cantLeaveEmpty")),a(this).closest("li").addClass("error"))});a("#editAccount .proText").focus(function(){a(this).closest("li").removeClass("error")});a(".m_address_box .address_edit,.m_address_box .address_add").click(function(){var b=a(this);if(!b.hasClass("hasAjax")){a(this).addClass("hasAjax");var c=a(this).attr("datatype"),d=a(this).attr("dataid");a.ajax({type:"GET",cache:!1,url:"/address/popedit?type\x3d"+c+"\x26id\x3d"+d,dataType:"html",success:function(c){a(".m_set_address").html(c);TT_NS.dialog.dialogBg(!0,{css:{"z-index":999}});a(".m_set_address").addClass("dialog_show");b.removeClass("hasAjax")},error:function(){b.removeClass("hasAjax")}})}});a(".m_address_box .address .checkA").click(function(){var b=!0;a(this).toggleClass("select");a(".m_address_box .address .checkA").each(function(c,d){a(d).hasClass("select")||(b=!1)});b?a(".m_address_box .other .checkA").addClass("select"):a(".m_address_box .other .checkA").removeClass("select")});a("body").on("click",".gender_list li",function(){a(".gender").val(a(this).data("value"));a(this).siblings().removeClass("sel");a(this).addClass("sel")});a(".m_address_box").on("click",".setting_default",function(){var b=a(this).attr("dataType"),c=a(this).attr("dataId");a.ajax({type:"GET",url:"/address/defaddress",dataType:"json",data:{id:c,type:b},success:function(a){1==a.ret?window.location.href=a.redirectUrl:TT_NS.dialog.confirm({addClass:"confirm_class",content:a.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})});a(".m_address_box .other .checkA").click(function(){a(this).hasClass("select")?(a(this).removeClass("select"),a(".m_address_box .address .checkA").removeClass("select")):(a(this).addClass("select"),a(".m_address_box .address .checkA").addClass("select"))});a(document).on("click","#shipping_address .save_address_btn",function(){var b=a(this);a(this).closest(".list").siblings(".list").find(".proText").each(function(){""==a(this).val()&&(a(this).siblings("p").text(a(this).siblings("p").data("tips")),a(this).closest("div").not(".can-empty").addClass("error"))});var c=a("#shipping_address .country_id");""==c.val()&&(c.closest(".left").addClass("error"),c=c.closest(".m_pullDown_country").siblings("p"),c.text(c.data("tips")));if(0!=a("#shipping_address").find(".error").length||0!=b.parents("#shipping_address").find(".erro_info").length||b.hasClass("hasAjax"))return!1;b.addClass("hasAjax");var c=a(".address_book li").length,d=a("#shipping_address").serializeArray();d.push({name:"count",value:c});a.ajax({type:"POST",url:"/address/write",data:d,dataType:"json",success:function(a){1==a.ret?window.location.href=TT_CONFIG.userLangUrl+"/member/registerupdate?type\x3d3":b.parents("#shipping_address").find(".dialog_main h4").before("\x3cspan class\x3d'erro_info'\x3e"+a.msg+"\x3c/span\x3e")}})});a(document).on("blur","#shipping_address .proText",function(){""==a(this).val()&&(a(this).siblings("p").text(a(this).siblings("p").data("tips")),a(this).closest("div").not(".can-empty").addClass("error"))});a(document).on("focus","#shipping_address .proText",function(){a(this).closest("div").removeClass("error")});a(document).on("keyup",".postCode_val",function(){var b=a(this).val().replace(/(^[^A-Za-z0-9]+)|([^\s\w-]+)|[/_]/gi,"").replace(/[\s-]{2,}/gi,"").replace(/([\s\w-]{1,10})(.*)/,"$1");a(this).val(b)});a(document).on("blur",".postCode_val",function(){var b=a(this).val(),c=b.substring(b.length-1,b.length);if(" "==c||"-"==c)b=b.substring(0,b.length-1),a(this).val(b)});a(".m_address_box .address_remove").click(function(){var b=a(".address_box_c li").length;if(1<b){var c=a(this).attr("dataId"),d=a(this);TT_NS.dialog.confirm({addClass:"confirm_class",content:TT_NS.lang.getLangForKey("account.sureToDelete","Are you sure to delete it?"),btnTextA:TT_NS.lang.getLangForKey("product.cancel"),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0},function(e){e&&a.ajax({type:"POST",url:"/address/delete",dataType:"json",data:{dataId:c},success:function(c){1==c.ret?(d.parent().parent("li").remove(),2==b&&a.ajax({type:"POST",url:"/address/defaddressfinally",dataType:"json",data:{type:d.attr("datatype")},success:function(a){1==a.ret&&(window.location.href=window.location.href)}})):TT_NS.dialog.alert({content:c.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})})}else TT_NS.dialog.confirm({addClass:"confirm_class",content:TT_NS.lang.getLangForKey("account.lastAddressDelTips","The last shipping address can not be deleted"),btnTextA:TT_NS.lang.getLangForKey("product.cancel"),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})});a(".m_address_box .remove_all p").click(function(){0<a(".address_select").find(".select").length&&1<a(".address_book li").length&&TT_NS.dialog.confirm({addClass:"confirm_class",content:TT_NS.lang.getLangForKey("account.sureToDeleteAll","Are you sure to delete all?"),btnTextA:TT_NS.lang.getLangForKey("product.cancel"),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0},function(b){if(b){var c=[];a(".address_select").find(".select").each(function(){c.push(a(this).attr("dataId"))});a.ajax({type:"POST",url:"/address/delete",dataType:"json",data:{dataId:c.join(",")},success:function(b){1==b.ret?a(".address_select").find(".select").parent().parent("li").remove():TT_NS.dialog.alert({content:b.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})}})});a(".m_my_coupon").on("click",".bm_tab_but li",function(){var b=a(this),c=b.index(),d=a(".my_all_coupon_c ul").children("li").eq(c);d.addClass("page_cur").siblings().removeClass("page_cur");b.addClass("cur").siblings().removeClass("cur");d.html('\x3cdiv class\x3d"ajax_loding"\x3e\x3c/div\x3e').show().siblings().hide();b.hasClass("hasAjax")||(d=b.attr("data-type"),b.addClass("hasAjax"),a.ajax({type:"GET",url:TT_CONFIG.userLangUrl+"/wallet/coupon",data:{type:d},dataType:"html",success:function(d){a(".my_all_coupon_c ul").children("li").eq(c).html(d);b.removeClass("hasAjax")},error:function(){b.removeClass("hasAjax")}}))});a(".m_my_message").on("click","dd .checkA",function(){var b=!0;a(this).toggleClass("select");a(".m_my_message .message dd .checkA").each(function(c,d){a(d).hasClass("select")||(b=!1)});b?a(".m_my_message .message dt .checkA").addClass("select"):a(".m_my_message .message dt .checkA").removeClass("select")});a(".m_my_message").on("click","dt .checkA",function(){a(this).hasClass("select")?(a(this).removeClass("select"),a(".m_my_message .message dd .checkA").removeClass("select")):(a(this).addClass("select"),a(".m_my_message .message dd .checkA").addClass("select"))});a(".m_my_message").on("click",".bm_tab_but li",function(){var b=a(this),c=b.index();oCur=a(".my_message_list").children("li").eq(c);oCur.addClass("page_cur").siblings().removeClass("page_cur");TT_NS.oprationClass.radioClass(a(".m_my_message .bm_tab_but li"),a(this),"cur");oCur.html('\x3cdiv class\x3d"ajax_loding"\x3e\x3c/div\x3e').show().siblings().hide();if(!b.hasClass("hasAjax")){var d=b.attr("data-type");b.addClass("hasAjax");a.ajax({type:"GET",url:"/message/index",data:{type:d},dataType:"html",success:function(d){a(".my_message_list").children("li").eq(c).html(d);b.removeClass("hasAjax")},error:function(){b.removeClass("hasAjax")}})}});a(".m_my_message .title .delete").click(function(){0<a(".m_my_message .message dd .select").length&&TT_NS.dialog.confirm({addClass:"confirm_class",content:TT_NS.lang.getLangForKey("account.sureToDelete","Are you sure to delete it?"),btnTextA:TT_NS.lang.getLangForKey("product.cancel"),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0},function(b){if(b){var c=[];a(".m_my_message .message dd .select").each(function(){var b=a(this).attr("dataId")+":"+a(this).attr("tab");c.push(b)});a.ajax({type:"POST",url:"/message/delete",dataType:"json",data:{dataId:c.join(",")},success:function(b){1==b.ret?(a(".m_my_message .message dd .select").parent().parent().remove(),window.location.reload()):TT_NS.dialog.alert({content:b.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})}})});a(".m_my_message .title .read").click(function(){0<a(".m_my_message .message dd .select").length&&TT_NS.dialog.confirm({addClass:"confirm_class",content:TT_NS.lang.getLangForKey("account.sureToRead","Are you sure to read it?"),btnTextA:TT_NS.lang.getLangForKey("product.cancel"),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0},function(b){if(b){var c=[],d=a(".m_my_message .message dd .select");d.each(function(){var b=a(this).attr("dataId")+":"+a(this).attr("tab");c.push(b)});console.log(c);a.ajax({type:"POST",url:"/message/read",dataType:"json",data:{dataId:c.join(",")},success:function(b){1==b.ret?1==a(".my_message_list .page_cur").index()?d.parent().parent().remove():d.parent().parent().addClass("is_read"):TT_NS.dialog.alert({content:b.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})}})});a(".my_message_list .subject a").on("click",function(){var b=a(this),c=b.attr("href");a.ajax({type:"GET",url:c,dataType:"json",success:function(a){1==a.ret&&b.parent().parent().addClass("is_read")}})});var l={timmer:null,init:function(){this.showEwm()},showEwm:function(){var b=this;a(document).on("mouseover",".track_contain .track_num",function(){a(this).next(".track_information").show()});a(document).on("mouseout",".track_contain .track_num",function(){var c=a(this);b.timmer=setTimeout(function(){c.next(".track_information").hide()},200)});a(document).on("mouseover",".track_information",function(){clearTimeout(b.timmer);a(this).show()});a(document).on("mouseout",".track_information",function(){a(this).hide()})}};a(function(){l.init()});a(".order_box .bm_tab_but li").click(function(){var b=a(this).index();TT_NS.oprationClass.radioClass(a(".order_box .bm_tab_but li"),a(this),"cur");var c=a(".order_main ").children("li").eq(b);c.addClass("page_cur").siblings().removeClass("page_cur");c.html('\x3cdiv class\x3d"ajax_loding"\x3e\x3c/div\x3e').show().siblings().hide();if(!a(this).hasClass("hasAjax")){"4"==b?a("input[name\x3d'isShow']").val(2):a("input[name\x3d'isShow']").val("");var c=a(this).attr("cate_id"),d=a("input[name\x3dsize]").val(),e=a("input[name\x3disShow]").val(),f=a(this);f.addClass("hasAjax");a.ajax({type:"GET",url:TT_CONFIG.userLangUrl+"/order/index",data:{status:c,size:d,isShow:e},dataType:"html",success:function(c){a(".order_main ").children("li").eq(b).html(c);f.removeClass("hasAjax");for(c=0;c<a(".count_time").length;c++)a(".count_time").eq(c).attr("ctnum","count_time"+c),fnCountdownD(a(".count_time").eq(c))},error:function(){f.removeClass("hasAjax")}})}});a(".show_c").on("click",".page_search",function(){var b=a(this).html();a("input[name\x3d'size']").val(b);a(this).addClass("cur").siblings().removeClass("cur");var b=a(".order_box .bm_tab_but .cur").index(),c=a(".order_main ").children("li").eq(b);c.html('\x3cdiv class\x3d"ajax_loding"\x3e\x3c/div\x3e').show().siblings().hide();var b=a(".order_box .bm_tab_but .cur").attr("cate_id"),d=a("input[name\x3dsize]").val(),e=a("input[name\x3disShow]").val();a(".order_box .bm_tab_but .cur");a.ajax({type:"GET",url:TT_CONFIG.userLangUrl+"/order/index",data:{status:b,size:d,isShow:e},dataType:"html",success:function(a){c.html(a)}})});a("#search_submit").on("click",function(){var b=a(".order_box .bm_tab_but .cur").attr("index"),c=a(".order_main ").children("li").eq(b);a(".order_main ").children("li").html('\x3cdiv class\x3d"ajax_loding"\x3e\x3c/div\x3e');a("input[name\x3d'isShow']").val("");b=a("#orderSearch").serializeArray();a.ajax({type:"GET",url:TT_CONFIG.userLangUrl+"/order/index",data:b,dataType:"html",success:function(a){c.html(a)}})});a(".order_box").on("click","thead .checkA",function(){a(this).toggleClass("select");a(this).parents("li").find(".other .checkA").removeClass("select")});a(".order_box").on("click"," .order_select_all",function(){a(this).hasClass("select")?(a(this).removeClass("select"),a(this).parents("li").find(".thead").find(".checkA").removeClass("select")):(a(this).addClass("select"),a(this).parents("li").find(".thead").find(".checkA").addClass("select"))});a(".order_box").on("click",".order_delete",function(){var b=a(this).parents(".m_order_list").attr("order-id"),c=a(this).attr("data-type"),d="",d="RECOVER"==c?TT_NS.lang.getLangForKey("account.sureToRestore","Are you sure to restore it?"):TT_NS.lang.getLangForKey("account.sureToDelete","Are you sure to delete it?"),e=a(this);TT_NS.dialog.confirm({addClass:"confirm_class",content:d,btnTextA:TT_NS.lang.getLangForKey("product.cancel"),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0},function(d){d&&a.ajax({type:"POST",url:"/order/delorders",data:{order_ids:b,type:c},dataType:"json",success:function(b){if(1==b.ret){var c=a(".order_box .bm_tab_but .cur").attr("index"),c=a(".order_main ").children("li").eq(c);e.parents("table").remove();a(".order_status_recycle").html("\x3ci\x3e\x3c/i\x3e("+b.recycle+")");a(".order_status_all").html("("+b.all+")");a(".my_orders_count").html(b.all);a(".order_status_pending").html("("+b.pending+")");a(".order_status_confirmed").html("("+b.confirmed+")");a(".order_status_processing").html("("+b.processing+")");0==c.find("table").length&&a(".order_box .bm_tab_but .cur").click()}else TT_NS.dialog.alert({content:b.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})})});a(".order_box").on("click",".remove_all p",function(){var b=[];a(".order_main table thead").find(".select").each(function(){b.push(a(this).parents(".m_order_list").attr("order-id"))});var c=a(this).attr("data-type"),d="",d=3==c?TT_NS.lang.getLangForKey("account.sureToRestore","Are you sure to restore it?"):TT_NS.lang.getLangForKey("account.sureToDelete","Are you sure to delete it?");0!=b.length&&TT_NS.dialog.confirm({addClass:"confirm_class",content:d,btnTextA:TT_NS.lang.getLangForKey("product.cancel"),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0},function(d){d&&a.ajax({type:"POST",url:"/order/delorders",data:{order_ids:b.join(","),type:c},dataType:"json",success:function(b){if(1==b.ret){var c=a(".order_box .bm_tab_but .cur").attr("index"),c=a(".order_main ").children("li").eq(c);a(".order_main table thead").find(".select").parents("table").remove();a(".order_status_recycle").html("\x3ci\x3e\x3c/i\x3e("+b.recycle+")");a(".order_status_all").html("("+b.all+")");a(".my_orders_count").html(b.all);a(".order_status_pending").html("("+b.pending+")");a(".order_status_confirmed").html("("+b.confirmed+")");a(".order_status_processing").html("("+b.processing+")");0==c.find("table").length&&a(".order_box .bm_tab_but .cur").click()}else TT_NS.dialog.alert({content:b.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})})});a(".m_my_points").on("click",".bm_tab_but li",function(){var b=a(this),c=b.index(),d=a(".my_all_coupon_c ul").children("li").eq(c);d.addClass("page_cur").siblings().removeClass("page_cur");b.addClass("cur").siblings().removeClass("cur");d.html('\x3cdiv class\x3d"ajax_loding"\x3e\x3c/div\x3e').show().siblings().hide();if(!b.hasClass("hasAjax")){var d=b.attr("data-type"),e=a(".m_my_points .show_num").find(".on").text();b.addClass("hasAjax");a.ajax({type:"GET",url:"/wallet/point",data:{type:d,size:e},dataType:"html",success:function(d){a(".my_all_coupon_c ul").children("li").eq(c).html(d);b.removeClass("hasAjax")},error:function(){b.removeClass("hasAjax")}})}});a(".m_my_points").on("click",".show_num a",function(){a(this).addClass("on").siblings().removeClass("on");a(".m_my_points .bm_tab_but ").find(".cur").click()});a(".m_personal_profile .profile .bm_tab_but li").click(function(){var b=a(".m_personal_profile .profile .bm_tab_but li").index(a(this));TT_NS.oprationClass.radioClass(a(".m_personal_profile .profile .bm_tab_but li"),a(this),"cur");b=a(".m_personal_profile .profile .profile_c\x3eli").eq(b);a(".m_personal_profile .profile .profile_c\x3eli").not(b).hide();b.fadeIn()});a(".m_personal_profile .edit_picture").click(function(){a(this).blur();TT_NS.dialog.dialogBg(!0,{css:{"z-index":999}});a(".m_set_picture").addClass("dialog_show")});a(".reviews_header").on("click",".show_c a",function(){a(this).addClass("cur").siblings().removeClass("cur");a("input[name\x3dsize]").val(a(this).text());a(".reviews_header .review_search").click()});a(".reviews_header .review_search").on("click",function(){var b=a(".reviews_box .bm_tab_but").find(".cur").index(),c=a(".reviews_box .m_reviews_list").children("li").eq(b);c.html('\x3cdiv class\x3d"ajax_loding"\x3e\x3c/div\x3e');b=a("#reviewSearch").serializeArray();a.ajax({type:"GET",url:TT_CONFIG.userLangUrl+"/review/index",data:b,dataType:"html",success:function(a){c.html(a)}})});a(".wishlist_box .m_wishlist_list .checkA").click(function(){var b=!0;a(this).toggleClass("select");a(".wishlist_box .m_wishlist_list .checkA").each(function(c,d){a(d).hasClass("select")||(b=!1)});b?a(".wishlist_box .other .checkA").addClass("select"):a(".wishlist_box .other .checkA").removeClass("select")});a(".search .wish_search").on("click",function(){a("#wishSearch").submit()});a(".wishlist_box .other .checkA").click(function(){a(this).hasClass("select")?(a(this).removeClass("select"),a(".wishlist_box .m_wishlist_list .checkA").removeClass("select")):(a(this).addClass("select"),a(".wishlist_box .m_wishlist_list .checkA").addClass("select"))});a(".wishlist_box .remove_wishlist").click(function(){var b=a(this).find("a").attr("dataid"),c=a(this);TT_NS.dialog.confirm({addClass:"confirm_class",content:TT_NS.lang.getLangForKey("account.sureToDelete","Are you sure to delete it?"),btnTextA:TT_NS.lang.getLangForKey("product.cancel"),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0},function(d){d&&a.ajax({type:"POST",url:"/wish/delete",data:{ids:b},dataType:"json",success:function(b){if(1==b.ret){c.parents("tr").remove();a(".has_num").find("em").text(parseInt(a(".has_num").find("em").text()-1));b=window.location.href;var d=a(".has_num").find("em").text();if(-1!==b.indexOf("chicuu")){if(0==a(".m_wishlist_list tbody").find("tr").length||0==d%10)b=a(".m_head .favoritesHeader").attr("href"),window.location.href=b}else 0==a(".m_wishlist_list tbody").find("tr").length&&(b=a(".m_head .favoritesHeader").attr("href"),window.location.href=b)}else TT_NS.dialog.alert({content:b.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})})});a(".wishlist_box .remove_all p").click(function(){var b=[],c=a(".m_wishlist_list table td").find(".select");c.each(function(){b.push(a(this).attr("data-id"))});0!=b.length&&TT_NS.dialog.confirm({addClass:"confirm_class",content:TT_NS.lang.getLangForKey("account.sureToDeleteAll","Are you sure to delete all?"),btnTextA:TT_NS.lang.getLangForKey("product.cancel"),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0},function(d){d&&a.ajax({type:"POST",url:"/wish/delete",data:{ids:b.join(",")},dataType:"json",success:function(d){if(1==d.ret){c.parents("tr").remove();a(".has_num").find("em").text(parseInt(a(".has_num").find("em").text()-b.length));d=window.location.href;var e=a(".has_num").find("em").text();if(-1!==d.indexOf("chicuu")){if(0==a(".m_wishlist_list tbody").find("tr").length||0==e%10)d=a(".m_head .favoritesHeader").attr("href"),window.location.href=d}else 0==a(".m_wishlist_list tbody").find("tr").length&&(d=a(".m_head .favoritesHeader").attr("href"),window.location.href=d)}else TT_NS.dialog.alert({content:d.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})})});a(document).on("mouseover",".product_Reviews em",function(){var b=a(this).index()+1;a(this).parents(".product_Reviews").addClass("startH"+b)});a(document).on("mouseleave",".product_Reviews em",function(){var b=a(this).index()+1;a(this).parents(".product_Reviews").removeClass("startH"+b)});a(document).on("click",".product_Reviews em",function(){var b=a(this).index()+1;if(0<a(this).parents(".product_Reviews").attr("class").indexOf("start")){var c=a(this).parents(".product_Reviews").attr("class").indexOf("start"),c=a(this).parents(".product_Reviews").attr("class").substr(c,6);a(this).parents(".product_Reviews").removeClass(c)}a(this).parents(".product_Reviews").addClass("start"+b);a(this).parents(".product_Reviews").siblings("input").val(b);var b=parseInt(a("input[name\x3d'ipriceStarWidth']").val()),c=parseInt(a("input[name\x3d'iqualityStarWidth']").val()),d=parseInt(a("input[name\x3d'iusefulness']").val()),e=parseInt(a("input[name\x3d'ishippingStarWidth']").val()),b=(b+c+d+e)/4*20+"%";a("#foverallratingStarWidth").css({width:b})});h.prototype={errorCode:{not:0,service:1,type:2,size:3},listener:function(){this.inputFile.on("change",a.proxy(this.change,this));this.uploadForm.on("submit",a.proxy(this.uploadFn,this))},clear:function(){var a=this.inputFile.clone(!0);this.inputFile.after(a);this.inputFile.remove();this.inputFile=a},error:function(a){switch(a){case this.errorCode.size:this.erroMsg.show().html("max size "+this.acceptSize+"kb");break;case this.errorCode.type:this.erroMsg.show().html("Invalid image formats");break;case this.errorCode.service:this.erroMsg.show().html("service error")}this.saveBtn.attr("disabled","disabled");this.clear()},change:function(a,c){var b=void 0!==a.target.files?a.target.files[0]:a.target.value?{name:a.target.value.replace(/^.+\\/,"")}:null;"clear"===c?this.clear():b?/^.*\.(jpg|gif|png)$/i.test(b.name)?b.size/1024>this.acceptSize?this.error(this.errorCode.size):(this.erroMsg.hide().html(""),(b=a.target.files)&&0<b.length&&(b=b[0],b=(window.URL||window.webkitURL).createObjectURL(b),this.previewEle.children("img").attr("src",b),this.saveBtn.attr("disabled",!1))):this.error(this.errorCode.type):this.clear()},uploadFn:function(){var b=this.uploadForm.attr("action"),c=this;c.loading.show();this.saveBtn.attr("disabled",!0);var d=this.uploadForm.parents(".bm_dialog");a.ajax({type:"POST",url:b,cache:!1,data:new FormData(a("#photo-form")[0]),processData:!1,contentType:!1,dataType:"json",success:function(b){1==b.ret?(c.loading.hide(),a("#head_picture").attr("src",b.uploaedFile),g.dialog.closeDialog(d),c.saveBtn.attr("disabled","disabled"),c.clear()):c.erroMsg.show().html("service error")},error:function(){}});return!1}};new h;a(".send_email").on("click",function(){var b=a(this);b.hasClass("hasAjax")||(b.addClass("hasAjax"),a.ajax({type:"POST",url:"/account/sendemail",dataType:"json",success:function(a){1==a.ret&&TT_NS.dialog.alert({content:TT_NS.lang.getLangForKey("account.activateEmailTips","Resent successfully. Please check your email box to activate your account."),btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0});b.removeClass("hasAjax")},error:function(){b.removeClass("hasAjax")}}))});a("input[name\x3d'cpassword']").focus(function(){""==a(this).val()&&(a(this).siblings("em").show().text(TT_NS.lang.getLangForKey("message.cannotBeEmpty")),a(this).closest("li").addClass("error"))});a(".change_password input").each(function(){a(this).blur(function(){if(""==a(this).val())a(this).siblings("em").show(),a(this).closest("li").addClass("error"),changpsw_flag=!1;else if("cnewpassword"==a(this).attr("name")){var b=a(this).val();6>b.length&&""!==b&&(a(this).siblings("em").show().text(TT_NS.lang.getLangForKey("account.enter6Characters","Please enter at least 6 characters!")),a(this).closest("li").addClass("error"))}else if("ccnewpassword"==a(this).attr("name")){var b=a("input[name\x3d'cnewpassword']").val(),c=a(this).val();b!==c&&(a(this).siblings("em").show().text(TT_NS.lang.getLangForKey("account.enterPasswordAbove","Enter the same password as above!")),a(this).closest("li").addClass("error"))}})});a(".change_password input").each(function(){a(this).focus(function(){a(this).siblings("em").hide();a(this).closest("li").removeClass("error")})});a("#change_password").on("submit",function(){var b=a(this).attr("action"),c=a(this).serializeArray();console.log(c);a.each(c,function(b,c){c.value||(a("input[name\x3d'"+c.name+"']").closest("li").addClass("error"),a("input[name\x3d'"+c.name+"']").siblings("em").show())});0==a("#change_password").find(".error").length&&a.ajax({type:"POST",url:b,dataType:"json",data:c,success:function(b){1==b.ret?window.location.href=b.redirectUrl:"-1004"==b.errCode||"-1"==b.errCode?(a("input[name\x3d'cpassword']").closest("li").addClass("error"),a("input[name\x3d'cpassword']").siblings("em").show().text(b.msg)):"-1001"==b.errCode&&(a("input[name\x3d'code']").closest("li").addClass("error"),a("input[name\x3d'code']").siblings("em").show().text(b.msg))}});return!1});a(".address").on("click",".address_default_c",function(){var b=a(this).attr("dataType"),c=a(this).attr("dataId");a.ajax({type:"GET",url:"/address/defaddress",dataType:"json",data:{id:c,type:b},success:function(a){1==a.ret?window.location.href=a.redirectUrl:TT_NS.dialog.confirm({addClass:"confirm_class",content:a.msg,btnTextB:TT_NS.lang.getLangForKey("product.ok"),shake:!0})}})});a("#page_list_container").on("click",".bm_page li a",function(){var b=a(this).attr("href");if(b){var c=a("#page_list_container").find(".page_cur");c.html('\x3cdiv class\x3d"ajax_loding"\x3e\x3c/div\x3e');a.ajax({type:"GET",url:b,dataType:"html",success:function(a){c.html(a)}})}return!1});a(document).ready(function(){0<a(".m_zclip_copy").size()&&k()});a(document).on("click",".m_get_free .profile_t a",function(){a(this).siblings("a").removeClass("cur");a(this).addClass("cur")});a(document).on("click",".getFreeBtn",function(){a(".m_zclip_copy .sucTips").hide();TT_NS.dialog.dialogBg(!0,{css:{"z-index":999}});a(".getFree").addClass("dialog_show");var b=a(this).parents("li.lineBlock"),c=a(this).parents("li.lineBlock").attr("data-url"),d=a(this).siblings(".productImg").attr("href"),e=a(this).siblings(".productImg").html(),f=a(this).siblings(".productTitle").prop("outerHTML"),g=a(this).siblings(".priceWarp").html();a(".getFree .m_product_box .share_pic").attr("data-url",c);a(".getFree .m_product_box .share_pic").attr("data-sku",b.attr("data-sku"));a(".getFree .m_product_box .share_pic").attr("data-listingid",b.attr("data-listingid"));a(".getFree .m_product_box .share_pic").attr("data-storageid",b.attr("data-storageid"));a(".getFree .m_product_box .share_pic").attr("data-actcode",b.attr("data-actcode"));a(".getFree .m_product_box .product_img a").attr("href",d);a(".getFree .m_product_box .product_img a").html(e);a(".getFree .m_product_box .product_title").html(f).children("a").removeClass("productTitle");a(".getFree .product_price").html(g);a(".getFree .m_zclip_copy .copyTxt").text(c);a(".getFree .m_product_box .view_prd").attr("href",d);k()});a(document).on("click",".share_pic i",function(){var b=a(this).parent(".share_pic"),c=b.attr("data-sku"),d=b.attr("data-listingid"),e=b.attr("data-storageid"),f=b.attr("data-actcode"),g=a(this).attr("data-name"),b=b.data("url");a.ajax({type:"POST",url:"/get-it-free/count",data:{sku:c,listingId:d,storageId:e,actCode:f,sharePlatform:g,shareUrl:b},dataType:"json",success:function(a){}})});a(document).on("click",".m_my_share .redeemCoupon button",function(){var b=a(this),c=a(this).parent(".redeemCoupon").siblings(".share_pic"),d=c.attr("data-sku"),e=c.attr("data-storageid"),c=c.attr("data-actcode");a(this).addClass("disRedeem");a.ajax({type:"POST",url:"/get-it-free/receive",data:{sku:d,storageId:e,actCode:c},dataType:"json",success:function(a){1==a.ret?b.next(".receiveTips").show():b.next(".receiveTips").text(a.msg).show()}})});g.share={init:function(){_this=this;a(document).on("click",".share_pic i",function(){var b=a(this).parent(".share_pic").data("url");_this.execute(a(this).data("name"),b)})},execute:function(a,c){console.log(c);window.open("https://api.addthis.com/oexchange/0.8/forward/"+a+"/offer?url\x3d"+c+"\x26pubid\x3dra-5688799e3f7e90e3\x26ct\x3d1\x26title\x3d\x26pco\x3dtbxnj-1.0","height\x3d500px, width\x3d750px, top\x3d150px, left\x3d250px, toolbar\x3dno, menubar\x3dno, scrollbars\x3dno, resizable\x3dno,location\x3dno, status\x3dno")}};return g}(window.TT_NS||{},jQuery);TT_NS.share.init();